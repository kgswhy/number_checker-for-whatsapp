// public/index.html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WhatsApp Number Checker</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-center mb-8">WhatsApp Number Checker</h1>
    
    <div id="status" class="mb-6 p-4 rounded-lg bg-white shadow">
      <h2 class="text-xl font-semibold mb-2">Connection Status</h2>
      <div class="flex items-center">
        <div id="status-indicator" class="w-4 h-4 rounded-full mr-2"></div>
        <span id="status-text">Loading...</span>
      </div>
      <div id="qr-container" class="mt-4 hidden"></div>
    </div>

    <div class="bg-white p-6 rounded-lg shadow">
      <h2 class="text-xl font-semibold mb-4">Check Numbers</h2>
      <textarea 
        id="numbers-input" 
        class="w-full p-3 border rounded mb-4" 
        rows="5" 
        placeholder="Enter numbers separated by commas or new lines"></textarea>
      <button 
        id="check-btn" 
        class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 disabled:bg-gray-400"
        disabled>
        Check Numbers
      </button>
    </div>

    <div id="results" class="mt-8 hidden">
      <h2 class="text-xl font-semibold mb-4">Results</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="bg-green-50 p-4 rounded-lg">
          <h3 class="font-medium text-green-800 mb-2">Active (<span id="active-count">0</span>)</h3>
          <div id="active-list" class="space-y-2"></div>
        </div>
        <div class="bg-red-50 p-4 rounded-lg">
          <h3 class="font-medium text-red-800 mb-2">Inactive (<span id="inactive-count">0</span>)</h3>
          <div id="inactive-list" class="space-y-2"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // DOM Elements
    const statusIndicator = document.getElementById('status-indicator');
    const statusText = document.getElementById('status-text');
    const qrContainer = document.getElementById('qr-container');
    const checkBtn = document.getElementById('check-btn');
    const numbersInput = document.getElementById('numbers-input');
    const resultsSection = document.getElementById('results');
    
    // Check connection status
    async function checkStatus() {
      try {
        const response = await fetch('/api/status');
        const { status } = await response.json();
        
        updateStatusUI(status);
        
        if (status === 'connected') {
          checkBtn.disabled = false;
        } else {
          checkBtn.disabled = true;
        }
      } catch (error) {
        console.error('Error checking status:', error);
      }
      
      setTimeout(checkStatus, 5000);
    }
    
    function updateStatusUI(status) {
      statusText.textContent = status.charAt(0).toUpperCase() + status.slice(1);
      
      switch(status) {
        case 'connected':
          statusIndicator.className = 'w-4 h-4 rounded-full mr-2 bg-green-500';
          qrContainer.classList.add('hidden');
          break;
        case 'qr_ready':
          statusIndicator.className = 'w-4 h-4 rounded-full mr-2 bg-yellow-500';
          qrContainer.classList.remove('hidden');
          fetchQRCode();
          break;
        default:
          statusIndicator.className = 'w-4 h-4 rounded-full mr-2 bg-red-500';
          qrContainer.classList.add('hidden');
      }
    }
    
    async function fetchQRCode() {
      try {
        const response = await fetch('/api/qr');
        if (response.ok) {
          const qr = await response.text();
          qrContainer.innerHTML = qr;
        }
      } catch (error) {
        console.error('Error fetching QR:', error);
      }
    }
    
    // Check numbers
    checkBtn.addEventListener('click', async () => {
      const numbersText = numbersInput.value.trim();
      if (!numbersText) return;
      
      const numbers = numbersText.split(/[\n,]+/).map(n => n.trim()).filter(n => n);
      
      try {
        checkBtn.disabled = true;
        checkBtn.textContent = 'Checking...';
        
        const response = await fetch('/api/check-numbers', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ numbers })
        });
        
        const { active, inactive } = await response.json();
        displayResults(active, inactive);
      } catch (error) {
        alert('Error checking numbers: ' + error.message);
      } finally {
        checkBtn.disabled = false;
        checkBtn.textContent = 'Check Numbers';
      }
    });
    
    function displayResults(active, inactive) {
      document.getElementById('active-count').textContent = active.length;
      document.getElementById('inactive-count').textContent = inactive.length;
      
      const activeList = document.getElementById('active-list');
      const inactiveList = document.getElementById('inactive-list');
      
      activeList.innerHTML = active.map(num => `
        <div class="p-2 bg-green-100 rounded flex justify-between items-center">
          <span>${num.number}</span>
          ${num.isBusiness ? '<span class="text-xs bg-green-200 px-2 py-1 rounded">Business</span>' : ''}
        </div>
      `).join('');
      
      inactiveList.innerHTML = inactive.map(num => `
        <div class="p-2 bg-red-100 rounded">${num}</div>
      `).join('');
      
      resultsSection.classList.remove('hidden');
    }
    
    // Initialize
    checkStatus();
  </script>
</body>
</html>